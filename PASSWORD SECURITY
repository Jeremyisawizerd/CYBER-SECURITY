"""
=====================================================
PASSWORD STRENGTH CHECKER & AUTHENTICATION SYSTEM
=====================================================
Project: Design and Implementation of a Simple Password 
         Strength Checker and Authentication System
Course: Cyber Security
University: Zetech University

MANDATORY REQUIREMENTS IMPLEMENTED:
- Password hashing (SHA-256)
- Password strength validation
- Input validation
- Secure storage principles
- Authentication logic
=====================================================
"""

import hashlib
import getpass  # For hidden password input
import re

# =====================================================
# COMPONENT 1: PasswordSecurity Class
# Handles password hashing and strength checking
# =====================================================
class PasswordSecurity:
    """
    Manages password security operations:
    - Hashing passwords using SHA-256
    - Checking password strength
    """
    
    @staticmethod
    def hash_password(password):
        """
        Hash the password using SHA-256
        Security Feature: One-way hashing - never stores plain text
        """
        # Convert password to bytes, hash it, return hex digest
        return hashlib.sha256(password.encode()).hexdigest()
    
    @staticmethod
    def check_strength(password):
        """
        Check password strength based on requirements:
        - Minimum length (â‰¥8 characters)
        - Contains uppercase letter
        - Contains lowercase letter
        - Contains number
        """
        checks = []
        
        # Check minimum length
        if len(password) >= 8:
            checks.append("âœ… Length: Good (8+ characters)")
        else:
            checks.append("âŒ Length: Must be at least 8 characters")
        
        # Check for uppercase letter
        if any(char.isupper() for char in password):
            checks.append("âœ… Uppercase: Present")
        else:
            checks.append("âŒ Uppercase: Missing")
        
        # Check for lowercase letter
        if any(char.islower() for char in password):
            checks.append("âœ… Lowercase: Present")
        else:
            checks.append("âŒ Lowercase: Missing")
        
        # Check for number
        if any(char.isdigit() for char in password):
            checks.append("âœ… Number: Present")
        else:
            checks.append("âŒ Number: Missing")
        
        # Determine if password meets all requirements
        is_strong = (
            len(password) >= 8 and
            any(char.isupper() for char in password) and
            any(char.islower() for char in password) and
            any(char.isdigit() for char in password)
        )
        
        return is_strong, checks
    
    @staticmethod
    def validate_username(username):
        """
        Validate username input
        Security Feature: Input validation
        """
        if not username or not username.strip():
            return False, "Username cannot be empty"
        
        if not re.match("^[a-zA-Z0-9_]+$", username):
            return False, "Username can only contain letters, numbers, and underscores"
        
        return True, "Username valid"

# =====================================================
# COMPONENT 2: User Class
# Represents a system user
# =====================================================
class User:
    """
    User class - stores user information securely
    Only stores hashed password, never plain text
    """
    
    def __init__(self, username, password):
        """
        Create a new user with hashed password
        Security Feature: Immediate password hashing
        """
        self.username = username
        # Store ONLY the hashed password - never the original
        self.hashed_password = PasswordSecurity.hash_password(password)

# =====================================================
# COMPONENT 3: AuthenticationSystem Class
# Manages user registration and login
# =====================================================
class AuthenticationSystem:
    """
    Authentication system that handles:
    - User registration with password strength check
    - User login with hash comparison
    - In-memory user storage (for simplicity)
    """
    
    def __init__(self):
        # Simple dictionary to store users (username: User object)
        self.users = {}
        self.current_user = None
    
    def register(self):
        """
        Register a new user
        Security Features:
        - Password strength validation
        - Password confirmation
        - Input validation
        - No plain text storage
        """
        print("\n" + "="*50)
        print("ğŸ“ USER REGISTRATION")
        print("="*50)
        
        # Get username
        username = input("Enter username: ").strip()
        
        # Validate username
        valid, message = PasswordSecurity.validate_username(username)
        if not valid:
            print(f"âŒ {message}")
            return False
        
        # Check if username exists
        if username in self.users:
            print("âŒ Username already exists!")
            return False
        
        # Display password requirements
        print("\nPassword Requirements:")
        print("â€¢ At least 8 characters long")
        print("â€¢ At least 1 uppercase letter")
        print("â€¢ At least 1 lowercase letter")
        print("â€¢ At least 1 number")
        
        # Get password (hidden input)
        password = getpass.getpass("Enter password: ")
        confirm = getpass.getpass("Confirm password: ")
        
        # Check if passwords match
        if password != confirm:
            print("âŒ Passwords do not match!")
            return False
        
        # Check password strength
        is_strong, strength_results = PasswordSecurity.check_strength(password)
        
        # Display strength check results
        print("\nğŸ“Š Password Strength Check:")
        for result in strength_results:
            print(f"  {result}")
        
        if not is_strong:
            print("\nâŒ Registration failed: Password does not meet requirements!")
            return False
        
        # Create new user (password is hashed automatically)
        self.users[username] = User(username, password)
        
        print(f"\nâœ… Registration successful for user: {username}")
        print("ğŸ” Security Note: Your password has been securely hashed")
        return True
    
    def login(self):
        """
        Authenticate a user
        Security Features:
        - Hashed password comparison
        - Secure error messages
        """
        print("\n" + "="*50)
        print("ğŸ” USER LOGIN")
        print("="*50)
        
        # Get credentials
        username = input("Username: ").strip()
        password = getpass.getpass("Password: ")
        
        # Check if user exists
        if username not in self.users:
            print("âŒ Invalid username or password")  # Generic message for security
            return False
        
        # Get user
        user = self.users[username]
        
        # Hash input password for comparison
        hashed_input = PasswordSecurity.hash_password(password)
        
        # Compare hashed passwords
        if hashed_input == user.hashed_password:
            self.current_user = user
            print(f"\nâœ… Login successful!")
            print(f"ğŸ‘‹ Welcome, {username}!")
            return True
        else:
            print("âŒ Invalid username or password")
            return False
    
    def logout(self):
        """Log out current user"""
        if self.current_user:
            print(f"\nğŸ‘‹ Goodbye, {self.current_user.username}!")
            self.current_user = None
        else:
            print("No user is currently logged in")
    
    def display_users(self):
        """Display all registered users (for demonstration)"""
        print("\n" + "="*50)
        print("ğŸ“‹ REGISTERED USERS")
        print("="*50)
        
        if not self.users:
            print("No users registered yet.")
            return
        
        for username, user in self.users.items():
            print(f"â€¢ {username} - Hash: {user.hashed_password[:20]}...")

# =====================================================
# MAIN PROGRAM
# =====================================================
def main():
    """Main program loop"""
    
    # Initialize authentication system
    auth = AuthenticationSystem()
    
    while True:
        print("\n" + "="*50)
        print("ğŸ” PASSWORD STRENGTH CHECKER & AUTHENTICATION SYSTEM")
        print("Zetech University - Cyber Security Project")
        print("="*50)
        print("\n1. ğŸ“ Register New User")
        print("2. ğŸ”‘ Login")
        print("3. ğŸšª Logout")
        print("4. ğŸ“‹ View Registered Users")
        print("5. âŒ Exit")
        
        choice = input("\nSelect option (1-5): ").strip()
        
        if choice == "1":
            auth.register()
            
        elif choice == "2":
            if auth.current_user:
                print(f"You are already logged in as {auth.current_user.username}")
            else:
                auth.login()
            
        elif choice == "3":
            auth.logout()
            
        elif choice == "4":
            auth.display_users()
            
        elif choice == "5":
            print("\n" + "="*50)
            print("Thank you for using the Authentication System!")
            print("Remember: Always use strong passwords! ğŸ”")
            print("="*50)
            break
            
        else:
            print("âŒ Invalid option. Please choose 1-5")

# =====================================================
# PROGRAM ENTRY POINT
# =====================================================
if __name__ == "__main__":
    main()
